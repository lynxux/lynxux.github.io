(function(e,t){var n=e(".ins-search"),d=n.find(".ins-search-input"),s=n.find(".ins-section-wrapper"),i=n.find(".ins-section-container");n.parent().remove(".ins-search"),e("body").append(n);function m(t){return e("<section>").addClass("ins-section").append(e("<header>").addClass("ins-section-header").text(t))}function r(n,s,o,i,a){return e("<div>").addClass("ins-selectable").addClass("ins-search-item").append(e("<header>").append(e("<i>").addClass("icon").addClass("icon-"+n)).append(s!=null&&s!=""?s:t.TRANSLATION.UNTITLED).append(o?e("<span>").addClass("ins-slug").text(o):null)).append(i?e("<p>").addClass("ins-search-preview").text(i):null).attr("data-url",a)}function h(e,n){var s,o;if(n.length===0)return null;switch(o=t.TRANSLATION[e],e){case"POSTS":s=n.map(function(e){return r("file",e.title,null,e.content.slice(0,150),e.uri)});break;case"CATEGORIES":case"TAGS":s=n.map(function(t){return r(e==="CATEGORIES"?"folder":"tag",t.title,"",null,t.uri)});break;default:return null}return m(o).append(s)}function c(e){return e.split(" ").filter(function(e){return!!e}).map(function(e){return e.toUpperCase()})}function a(e,t,n){var i=!1,s=c(e),o=s.filter(function(e){var s=n.filter(function(n){if(!t.hasOwnProperty(n))return!1;if(t[n].toUpperCase().indexOf(e)>-1)return!0});return s.length>0});return o.length===s.length}function b(e){return{POST:function(t){return a(e,t,["title","content"])},PAGE:function(t){return a(e,t,["title","content"])},CATEGORY:function(t){return a(e,t,["title"])},TAG:function(t){return a(e,t,["title"])}}}function o(e,t,n,s){var o=0;return c(e).forEach(function(e){var i=new RegExp(e,"img");n.forEach(function(e,n){if(t.hasOwnProperty(e)){var a=t[e].match(i);o+=a?a.length*s[n]:0}})}),o}function f(e){return{POST:function(t){return o(e,t,["title","content"],[3,1])},PAGE:function(t){return o(e,t,["title","content"],[3,1])},CATEGORY:function(t){return o(e,t,["title"],[1])},TAG:function(t){return o(e,t,["title"],[1])}}}function p(e,t){var n=f(t),s=b(t),o=e.posts,i=e.tags,a=e.categories;return{posts:o.filter(s.POST).sort(function(e,t){return n.POST(t)-n.POST(e)}).slice(0,5),categories:a.filter(s.CATEGORY).sort(function(e,t){return n.CATEGORY(t)-n.CATEGORY(e)}).slice(0,5),tags:i.filter(s.TAG).sort(function(e,t){return n.TAG(t)-n.TAG(e)}).slice(0,5)}}function g(e){i.empty();for(var t in e)i.append(h(t.toUpperCase(),e[t]))}function v(e){if(e.length===0)return;var n=s[0].clientHeight,o=e.position().top-s.scrollTop(),t=e[0].clientHeight+e.position().top;t>n+s.scrollTop()&&s.scrollTop(t-s[0].clientHeight),o<0&&s.scrollTop(e.position().top)}function l(t){var o,n=e.makeArray(i.find(".ins-selectable")),s=-1;n.forEach(function(t,n){if(e(t).hasClass("active")){s=n;return}}),o=(n.length+s+t)%n.length,e(n[s]).removeClass("active"),e(n[o]).addClass("active"),v(e(n[o]))}function u(e){e&&e.length&&(location.href=e.attr("data-url"))}e.getJSON(t.CONTENT_URL,function(t){location.hash.trim()==="#ins-search"&&n.addClass("show"),d.on("input",function(){var n=e(this).val();g(p(t,n))}),d.trigger("input")}),e(document).on("click focus",".search-form-input",function(){n.addClass("show"),n.find(".ins-search-input").focus()}).on("click",".ins-search-item",function(){u(e(this))}).on("click",".ins-close",function(){n.removeClass("show")}).on("keydown",function(e){if(!n.hasClass("show"))return;switch(e.keyCode){case 27:n.removeClass("show");break;case 38:l(-1);break;case 40:l(1);break;case 13:u(i.find(".ins-selectable.active").eq(0));break}})})(jQuery,window.INSIGHT_CONFIG)